# Plan: ロジックの実装

## フェーズ 1: ファイル読み込み機能のロジック実装

- [ ] Task: メインプロセス (`main/index.ts`) でファイル選択ダイアログを表示するIPCハンドラを実装
    - [ ] `ipcMain.handle` を使用して、レンダラープロセスからのファイルオープン要求を処理する。
    - [ ] `dialog.showOpenDialog` を呼び出し、テキストファイルのみ選択可能なフィルターを設定する。
    - [ ] 選択されたファイルのパスをレンダラープロセスに返す。キャンセル時は`undefined`を返す。
- [ ] Task: メインプロセスでファイルのコンテンツを読み込むIPCハンドラを実装
    - [ ] `ipcMain.handle` を使用して、レンダラープロセスからのファイルパスを受け取り、コンテンツを読み込む。
    - [ ] `fs.promises.readFile` を使用して非同期でファイルを読み込み、テキストとして返す。
    - [ ] エラーハンドリング（ファイルが存在しない、読み込み権限がないなど）を実装し、適切なエラーメッセージを返す。
- [ ] Task: レンダラープロセスからファイル読み込みをトリッジする機能の実装
    - [ ] `preload/index.ts` にて、 `ipcRenderer.invoke` を使用して `open-file-dialog` および `read-file-content` のIPC呼び出しを公開する。
    - [ ] `App.tsx` にて、メニュー項目やボタンからこれらのIPC呼び出しをトリッジする。
    - [ ] 読み込まれたコンテンツをReactのstateに設定し、エディタに表示する。
- [ ] Task: Conductor - User Manual Verification 'ファイル読み込み機能のロジック実装' (Protocol in workflow.md)

## フェーズ 2: 新規ファイル作成・保存機能のロジック実装 [checkpoint: 65ef728]

- [ ] Task: メインプロセスでファイル保存ダイアログを表示するIPCハンドラを実装
    - [ ] `ipcMain.handle` を使用して、レンダラープロセスからの保存要求を処理する。
    - [ ] `dialog.showSaveDialog` を呼び出し、ファイル名とパスを選択可能にする。
    - [ ] 選択されたファイルのパスをレンダラープロセスに返す。キャンセル時は`undefined`を返す。
- [ ] Task: メインプロセスでファイルのコンテンツを書き込むIPCハンドラを実装
    - [ ] `ipcMain.handle` を使用して、レンダラープロセスからのファイルパスとコンテンツを受け取り、ファイルに書き込む。
    - [ ] `fs.promises.writeFile` を使用して非同期でファイルを書き込む。
    - [ ] エラーハンドリング（書き込み権限がない、ディスク容量不足など）を実装し、適切なエラーメッセージを返す。
- [x] Task: レンダラープロセスから新規ファイル保存をトリッジする機能の実装
    - [ ] `preload/index.ts` にて、 `ipcRenderer.invoke` を使用して `save-file-dialog` および `write-file-content` のIPC呼び出しを公開する。
    - [ ] `App.tsx` にて、メニュー項目やボタンからこれらのIPC呼び出しをトリッジする。
    - [ ] 保存が成功した場合、またはエラーが発生した場合にUIにフィードバックを表示する。
- [x] Task: Conductor - User Manual Verification '新規ファイル作成・保存機能のロジック実装' (Protocol in workflow.md)

## フェーズ 3: 既存ファイルの上書き保存機能と未保存変更の警告

- [ ] Task: レンダラープロセスでの未保存変更の追跡
    - [ ] エディタの内容が変更された際に、未保存の変更があることを示すstateを管理する。
- [ ] Task: 既存ファイルの上書き保存ロジック実装
    - [ ] `App.tsx` にて、既存のファイルパスが判明している場合に、`write-file-content` IPC呼び出しを使用して直接ファイルを上書き保存する機能を提供する。
- [ ] Task: アプリケーション終了時の未保存変更警告
    - [ ] メインプロセス (`main/index.ts`) にて、ウィンドウが閉じられようとした際 (`window.on('close')`) に、レンダラープロセスに未保存変更の有無を問い合わせる。
    - [ ] レンダラープロセスは未保存変更がある場合、保存確認ダイアログを表示し、ユーザーの選択に応じて保存、破棄、キャンセルを処理する。
    - [ ] メインプロセスは、レンダラープロセスからの応答に基づいてウィンドウを閉じるか否かを決定する。
- [ ] Task: Conductor - User Manual Verification '既存ファイルの上書き保存機能と未保存変更の警告' (Protocol in workflow.md)
