# hello-rust (Axum Web API Sample)

このプロジェクトは、RustのモダンなWebフレームワークである **Axum** を使用した、シンプルなタスク管理（Todo）Web APIのサンプルです。

## 概要

メモリ上にデータを保持する「インメモリDB」の仕組みを利用して、タスクの作成・取得・更新・削除（CRUD）を行うAPIを実装しています。

## 実行方法

### サーバーの起動

```bash
cargo run
```

サーバーは `http://127.0.0.1:3000` で起動し、リクエストを待ち受けます。

### APIのテスト（実行例）

別のターミナルから `curl` コマンドを使用して動作を確認できます。

#### 1. タスクの作成 (POST)

```bash
curl -X POST -H "Content-Type: application/json" -d '{"title":"Rustを学ぶ"}' http://127.0.0.1:3000/tasks
```

#### 2. タスク一覧の取得 (GET)

```bash
curl http://127.0.0.1:3000/tasks
```

#### 3. タスクの更新 (PUT)

```bash
curl -X PUT -H "Content-Type: application/json" -d '{"completed":true}' http://127.0.0.1:3000/tasks/1
```

#### 4. タスクの削除 (DELETE)

```bash
curl -X DELETE http://127.0.0.1:3000/tasks/1
```

## コード解説

### インメモリDBの仕組み

Rustはメモリ安全性を重視するため、複数のスレッド（リクエスト）から同時にデータを書き換えることができません。本プロジェクトでは以下の標準ライブラリを組み合わせて安全に共有状態を管理しています。

- **`Arc<T>` (Atomic Reference Countered)**:
  スレッド間でデータの所有権を共有するための参照カウント型スマートポインターです。これにより、サーバーが複数のリクエストを同時に処理しても、同じデータ（DB）にアクセスできます。
- **`RwLock<T>` (Read-Write Lock)**:
  データの読み書きに対する排他制御（ロック）を提供します。
  - `read()`: データを参照する際に使用。複数のスレッドが同時に読み込むことができます。
  - `write()`: データを更新する際に使用。書き込み中は他のスレッドの読み書きをブロックし、一貫性を保ちます。

### Axum固有のクラス・機能

- **`Router`**:
  URLパスとそれに対応する処理（ハンドラー関数）を紐付けるルーティングの役割を担います。
- **`State`**:
  アプリケーション全体で共有する状態（今回は `Arc<RwLock<Vec<Task>>>`）を、各ハンドラー関数に「注入」するための仕組みです。
- **`Json<T>`**:
  リクエストのJSONボディをRustの構造体に変換したり、レスポンスの構造体をJSONに変換したりする「エクストラクター」兼「レスポンス」です。
- **`Path<T>`**:
  `/tasks/{id}` のように、URLパスに含まれる変数（パスパラメーター）を抽出するために使用します。
- **`StatusCode`**:
  `201 Created` や `404 Not Found` など、HTTPステータスコードを明示的に返すために利用します。
